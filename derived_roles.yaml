---
apiVersion: "api.cerbos.dev/v1"
derivedRoles:
  name: common_roles
  definitions:
    - name: admin_user
      parentRoles: ["super_admin"]
      condition:
        match:
          expr: request.principal.attr.role == "super_admin"

    - name: franchise_owner
      parentRoles: ["franchise_admin"]
      condition:
        match:
          all:
            of:
              - expr: request.resource.attr.franchiseId == request.principal.attr.franchiseId
              - expr: request.principal.attr.blocked == false
              - expr: request.principal.attr.role == "franchise_admin"
    
    - name: franchise_viewer
      parentRoles: ["franchise_admin", "super_admin"]
      condition:
        match:
          expr: request.principal.attr.blocked == false
